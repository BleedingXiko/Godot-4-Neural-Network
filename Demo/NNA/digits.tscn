[gd_scene load_steps=4 format=3 uid="uid://d0ukl4k71qi0q"]

[ext_resource type="PackedScene" uid="uid://62dl11wyn8eh" path="res://Demo/NNA/cell.tscn" id="3"]
[ext_resource type="Texture2D" uid="uid://yebdjybcg7n8" path="res://Demo/NNA/icon.png" id="5"]

[sub_resource type="GDScript" id="GDScript_1yay6"]
script/source = "extends Node2D


# Declare member variables here. Examples:
# var a = 2
# var b = \"text\"
var nn: NeuralNetworkAdvanced
var data = []

var numbers = [1,2,3,4,5,6,7,8,9,0]

var training_data = [{
			\"inputs\": [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0]
,
			\"target\": [1,0,0,0,0,0,0,0,0,0]
}, 
{
			\"inputs\": [0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0]
,
			\"target\": [1,0,0,0,0,0,0,0,0,0]
}, 
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0]
,
			\"target\": [0,1,0,0,0,0,0,0,0,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0]
,
			\"target\": [0,0,1,0,0,0,0,0,0,0]
},
{
			\"inputs\": [0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0]

,
			\"target\": [0,0,0,1,0,0,0,0,0,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0]

,
			\"target\": [0,0,0,0,1,0,0,0,0,0]
},
{
			\"inputs\": [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0]

,
			\"target\": [0,0,0,0,0,1,0,0,0,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0]

,
			\"target\": [0,0,0,0,0,1,0,0,0,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0]


,
			\"target\": [0,0,0,0,0,0,1,0,0,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0]


,
			\"target\": [0,0,0,0,0,0,1,0,0,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0]

,
			\"target\": [0,0,0,0,0,0,0,1,0,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0]

,
			\"target\": [0,0,0,0,0,0,0,0,1,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0]

,
			\"target\": [0,0,0,0,0,0,0,0,1,0]
},
{
			\"inputs\": [0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0]

,
			\"target\": [0,0,0,0,0,0,0,0,0,1]
}]

var network_config = {
	\"learning_rate\": 0.00000001,
	\"l2_regularization_strength\": 0.001,
	\"use_l2_regularization\": false,
}
# Called when the node enters the scene tree for the first time.
func _ready():
	nn = NeuralNetworkAdvanced.new(network_config)
	
	nn.add_layer(25)
	nn.add_layer(26, nn.ACTIVATIONS.RELU)
	nn.add_layer(16, nn.ACTIVATIONS.RELU)
	nn.add_layer(10, nn.ACTIVATIONS.SIGMOID)
	
	#nn.load(\"./nn.data\")
	test()
#	for n in get_children():
#		data.append(n.data)
#	print(data)

func test():
	for i in range(20000):
		var data = training_data.pick_random()
		nn.train(data.inputs, data.target)
	nn.save(\"./nn.data\")


func findMax(arr):
	var record = 0
	var index = 0
	for i in arr.size():
		if arr[i] > record:
			record = arr[i]
			index = i
	
	return index

func _input(event):
	if event.is_action_pressed(\"ui_down\"):
		nn.save(\"./nn.data\")
	if event.is_action_pressed(\"ui_accept\"):
		#nn.save_brain()
		data = []
		for n in $cells.get_children():
			data.append(n.data)
		
		
		var guess = numbers[findMax(nn.predict(data))]
		$Label2D.text = str(guess)
		print(nn.predict(data))

# Called every frame. 'delta' is the elapsed time since the previous frame.
#func _process(delta):
#	pass
"

[node name="digits" type="Node2D"]
script = SubResource("GDScript_1yay6")

[node name="TouchScreenButton" type="TouchScreenButton" parent="."]
position = Vector2(195, 326)
texture_normal = ExtResource("5")
action = "ui_accept"

[node name="Label2D" type="Label" parent="."]
offset_left = 16.0
offset_top = 341.0
offset_right = 26.0
offset_bottom = 364.0
text = "o"

[node name="cells" type="Node2D" parent="."]
scale = Vector2(2, 2)

[node name="cell" parent="cells" instance=ExtResource("3")]

[node name="cell2" parent="cells" instance=ExtResource("3")]
position = Vector2(32, 0)

[node name="cell3" parent="cells" instance=ExtResource("3")]
position = Vector2(64, 0)

[node name="cell4" parent="cells" instance=ExtResource("3")]
position = Vector2(96, 0)

[node name="cell5" parent="cells" instance=ExtResource("3")]
position = Vector2(128, 0)

[node name="cell6" parent="cells" instance=ExtResource("3")]
position = Vector2(0, 32)

[node name="cell7" parent="cells" instance=ExtResource("3")]
position = Vector2(32, 32)

[node name="cell8" parent="cells" instance=ExtResource("3")]
position = Vector2(64, 32)

[node name="cell9" parent="cells" instance=ExtResource("3")]
position = Vector2(96, 32)

[node name="cell10" parent="cells" instance=ExtResource("3")]
position = Vector2(128, 32)

[node name="cell11" parent="cells" instance=ExtResource("3")]
position = Vector2(0, 64)

[node name="cell12" parent="cells" instance=ExtResource("3")]
position = Vector2(32, 64)

[node name="cell13" parent="cells" instance=ExtResource("3")]
position = Vector2(64, 64)

[node name="cell14" parent="cells" instance=ExtResource("3")]
position = Vector2(96, 64)

[node name="cell15" parent="cells" instance=ExtResource("3")]
position = Vector2(128, 64)

[node name="cell16" parent="cells" instance=ExtResource("3")]
position = Vector2(0, 96)

[node name="cell17" parent="cells" instance=ExtResource("3")]
position = Vector2(32, 96)

[node name="cell18" parent="cells" instance=ExtResource("3")]
position = Vector2(64, 96)

[node name="cell19" parent="cells" instance=ExtResource("3")]
position = Vector2(96, 96)

[node name="cell20" parent="cells" instance=ExtResource("3")]
position = Vector2(128, 96)

[node name="cell21" parent="cells" instance=ExtResource("3")]
position = Vector2(0, 128)

[node name="cell22" parent="cells" instance=ExtResource("3")]
position = Vector2(32, 128)

[node name="cell23" parent="cells" instance=ExtResource("3")]
position = Vector2(64, 128)

[node name="cell24" parent="cells" instance=ExtResource("3")]
position = Vector2(96, 128)

[node name="cell25" parent="cells" instance=ExtResource("3")]
position = Vector2(128, 128)
